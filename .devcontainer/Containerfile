# -------- Dev Container --------
FROM node:23.11.0

RUN apt-get update && apt-get install -y -qq \
    git \
    curl \
    vim \
    neovim \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /workspace
RUN chown node:node /workspace
ENV PATH="/workspace/node_modules/.bin:$PATH"

RUN corepack enable && corepack prepare pnpm@10.10.0 --activate && corepack use pnpm@10.10.0
ENV COREPACK_ENABLE_STRICT=1

# ðŸ“¦ Copy only package info first
COPY --chown=node:node package.json pnpm-lock.yaml ./
RUN pnpm install
RUN apt-get install -y bash
RUN pnpm set config ignore-scripts true

# ðŸ‘‡ Then volume mount source files (during runtime)

USER node

ENV PORT=2998

EXPOSE 2998

CMD ["pnpm", "dev"]

